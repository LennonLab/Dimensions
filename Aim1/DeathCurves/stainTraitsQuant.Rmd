---
title: "Long-term dormancy: bet-hedging"
author: "Stuart E. Jones and Jay T. Lennon"
date: "`r format(Sys.time(), '%d %B, %Y')`"
header-includes:
   - \usepackage{array}
output: pdf_document
geometry: margin = 2.54cm
---

## Overview
We measured the single cell activity on cells from different populations under conditions with freshly supplied media after 1 vs. 1000 days. 
Single cell staining classified cells as either active (+ CTC), dead (+ SYTOX Green), or dormant (- CTC and - SYTOX Green).

## 1) SETUP

### A. Retrieve and Set Working Directory

```{r, results = 'hide'}
rm(list = ls())
getwd()
setwd("~/GitHub/Dimensions/Aim1/DeathCurves/")
```

### B. Load and Wrangle Data

```{r, results = 'hide'}
all <- read.table("data/staining.all.txt", header = TRUE, sep = "\t", 
    stringsAsFactors = FALSE)

# Parse ancestral and derived measures
anc <- all[all$hist == "anc",]
der <- all[all$hist == "der",]
```

Now we'll created new traits based on single-cell metabolic counts at the two time points
```{r}
# Create dataframe to hold new traits
newTraits = der

# Percent of non-CTC stained cells at day 1
newTraits$betHedge = NA

# Difference in CTC cells between day 1 and 1000
newTraits$deltaActive = NA

# Difference in Sytox Green cells between day 1 and 1000
newTraits$deltaDead = NA

# Difference in Sytox Green cells between day 1 and 1000
newTraits$deltaDormant = NA

newTraits = newTraits[,-(3:6)]

# Calculate traits --> NOTE: no ancestral measures for KBS0727

for(i in 1:nrow(der)){
	acur = anc[anc$strain == der$strain[i],]
	newTraits[i,3] = acur[1,6]
	newTraits[i,4:6] = der[i,4:6] - acur[1,4:6]
}

newTraits <- na.omit(newTraits)
```

### Plot Kernel Densities

```{r, results = 'hide'}
# dev.new()
# par(mfrow=c(4,1))
# hist(newTraits$betHedge, breaks=seq(0, 1, 0.05), main = NULL, xlab = "bet hedging")
# hist(newTraits$deltaActive, breaks = seq(-1,1,0.1), main = NULL, xlab = "delta Active")
# hist(newTraits$deltaDead, breaks = seq(-1,1,0.1), main = NULL, xlab = "delta Dead")
# hist(newTraits$deltaDormant, breaks = seq(-1,1,0.1), main = NULL, xlab = "delta Dormant")

bet.hedge.kern <- density(newTraits$betHedge)
delta.act.kern <- density(newTraits$deltaActive)
delta.dead.kern <- density(newTraits$deltaDead)
delta.dorm.kern <- density(newTraits$deltaDormant)

png(filename="~/GitHub/Dimensions/Aim1/DeathCurves/KernelShift.png",
    width = 800, height = 1200, res = 96*2)

layout <- layout(rbind(1, 2, 3)) 

# par(mai = c(0.5, 1.0, 0.5, 1.0))

# Plotting Delta Active
par(mar = c(2,7,4,4))
plot(delta.act.kern, xaxt = "n", yaxt = "n", main = NA, cex.lab = 1.5, ylab = "",
     xlab = "", xlim = c(-1.5, 1.5), ylim = c(0, 1.5), type = "l", 
     lty = 1, lwd = 3, col = "black")

     axis(side = 1, lwd.ticks = 2, cex.axis = 1.5, las = 1,
        labels = c("-1", "0", "1"), at = c(-1, 0, 1))

     axis(side = 3, lwd.ticks = 2.25, cex.axis = 2, las = 1,
        at = c(-1, 0, 1), labels = F)

     axis(side = 2, lwd.ticks = 2.25, cex.axis = 1.5, las = 1,
          labels = c("0", "0.5", "1.0", "1.5"), at = c(0, 0.5, 1.0, 1.5))

     axis(side = 4, lwd.ticks = 2.25, cex.axis = 2, las = 1,
        at = c(0, 0.5, 1.0, 1.5), labels = F)

box(lwd = 2.25)

mtext("Density", side = 2, line = 4, cex = 1.5)
mtext("Active", side = 3, line = 1, cex = 1.25, col = "black")
abline(v = 0, lty = 2, lwd = 2)

# Plotting Delta Dead
par(mar = c(2,7,4,4))
plot(delta.dead.kern, main = NA, xaxt = "n", yaxt = "n", cex.lab = 1.5, ylab = "",
     xlab = "", xlim = c(-1.5, 1.5), ylim = c(0, 1.5), type = "l", 
     lty = 1, lwd = 3, col = "black")

     axis(side = 1, lwd.ticks = 2, cex.axis = 1.5, las = 1,
        labels = c("-1", "0", "1"), at = c(-1, 0, 1))

     axis(side = 3, lwd.ticks = 2.25, cex.axis = 2, las = 1,
        at = c(-1, 0, 1), labels = F)

     axis(side = 2, lwd.ticks = 2.25, cex.axis = 1.5, las = 1,
          labels = c("0", "0.5", "1.0", "1.5"), at = c(0, 0.5, 1.0, 1.5))

     axis(side = 4, lwd.ticks = 2.25, cex.axis = 2, las = 1,
        at = c(0, 0.5, 1.0, 1.5), labels = F)

box(lwd = 2.25)

mtext("Density", side = 2, line = 4, cex = 1.5)
mtext("Dead", side = 3, line = 1, cex = 1.25, col = "black")
abline(v = 0, lty = 2, lwd = 2)

# Plotting Delta Dormant
par(mar = c(2,7,4,4))
plot(delta.dorm.kern, main = NA, xaxt = "n", yaxt = "n", cex.lab = 1.5, ylab = "",
     xlab = "", xlim = c(-1.5, 1.5), ylim = c(0, 1.5), type = "l", 
     lty = 1, lwd = 3, col = "black")

     axis(side = 1, lwd.ticks = 2, cex.axis = 1.5, las = 1,
        labels = c("-1", "0", "1"), at = c(-1, 0, 1))

     axis(side = 3, lwd.ticks = 2.25, cex.axis = 2, las = 1,
        at = c(-1, 0, 1), labels = F)

     axis(side = 2, lwd.ticks = 2.25, cex.axis = 1.5, las = 1,
          labels = c("0", "0.5", "1.0", "1.5"), at = c(0, 0.5, 1.0, 1.5))

     axis(side = 4, lwd.ticks = 2.25, cex.axis = 2, las = 1,
        at = c(0, 0.5, 1.0, 1.5), labels = F)

box(lwd = 2.25)

mtext("Density", side = 2, line = 4, cex = 1.5)
mtext("Dormant", side = 3, line = 1, cex = 1.25, col = "black")
abline(v = 0, lty = 2, lwd = 2)

dev.off() # this writes plot to folder
graphics.off() # shuts down open devices
```

### Calculate strain means
```{r, results = 'hide'}
# 
meanTraits = newTraits[1:length(unique(der$strain)),]
meanTraits = meanTraits[,-2]
meanTraits$strain = sort(unique(der$strain))
meanTraits[,2:ncol(meanTraits)] = NA
for(i in 2:5){
	curMeans = tapply(newTraits[,(i+1)], newTraits$strain, FUN = mean)
	meanTraits[,i] = curMeans[order(names(curMeans))]
}

# plot histograms of mean traits
dev.new()
par(mfrow=c(4,1))
hist(meanTraits$betHedge,breaks=seq(0,1,0.05),main=NULL,xlab="bet hedging")
hist(meanTraits$deltaActive,breaks=seq(-1,1,0.1),main=NULL,xlab="delta Active")
hist(meanTraits$deltaDead,breaks=seq(-1,1,0.1),main=NULL,xlab="delta Dead")
hist(meanTraits$deltaDormant,breaks=seq(-1,1,0.1),main=NULL,xlab="delta Dormant")
```
